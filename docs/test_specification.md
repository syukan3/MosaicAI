# MosaicAI テスト仕様書

## 1. 概要
この文書は、MosaicAIライブラリのテスト仕様を定義します。
ユニットテスト、インテグレーションテスト、エンドツーエンドテストの3つの主要なカテゴリでテストを行います。

## 2. テスト環境
- Python 3.7以上
- pytest
- pytest-mock

## 3. ユニットテスト

### 3.1 MosaicAIクラス
- `__init__`メソッドのテスト
  - 正しいモデルで初期化されることを確認
  - 無効なモデルでの初期化時に適切な例外が発生することを確認
- `generate_text`メソッドのテスト
  - モックを使用して各AIモデルの応答をシミュレート
  - 異なる入力に対する正しい出力を確認
- `generate_image_description`メソッドのテスト
  - 画像ファイルと共に正しく機能することを確認
  - 無効な画像パスでの適切なエラー処理を確認
- `generate_json`メソッドのテスト
  - 指定されたスキーマに従ってJSONが生成されることを確認
  - 無効なスキーマでの適切なエラー処理を確認
- `generate_with_image`メソッドのテスト
  - 画像とテキストの両方の入力が正しく処理されることを確認
- `generate_with_image_json`メソッドのテスト
  - 画像入力とJSONスキーマが正しく処理されることを確認
- `set_api_key`メソッドのテスト
  - APIキーが正しく設定されることを確認
- `from_config_file`クラスメソッドのテスト
  - 設定ファイルから正しくインスタンスが生成されることを確認

### 3.2 APIKeyManagerクラス
- `__init__`メソッドのテスト
  - 正しく初期化されることを確認
- `set_api_key`メソッドのテスト
  - APIキーが正しく設定され、暗号化されることを確認
- `get_api_key`メソッドのテスト
  - 設定されたAPIキーが正しく取得され、復号化されることを確認
- `load_from_env`メソッドのテスト
  - 環境変数からAPIキーが正しく読み込まれることを確認

### 3.3 各AIモデルクラス（ChatGPT, Claude, Gemini, Perplexity）
- `__init__`メソッドのテスト
  - 正しく初期化されることを確認
- `generate`メソッドのテスト
  - モックを使用してAPI呼び出しをシミュレート
  - 正しい応答が返されることを確認
- `generate_json`メソッドのテスト
  - JSONスキーマに従って正しく生成されることを確認
- モデル固有のメソッドのテスト（例：画像処理機能）

## 4. インテグレーションテスト

### 4.1 MosaicAIと各AIモデルの統合
- 実際のAPIキーを使用して各モデルとの接続をテスト
- 異なるタイプの入力（テキスト、画像、JSONスキーマ）での統合をテスト

### 4.2 APIKeyManagerとMosaicAIの統合
- APIKeyManagerを使用してMosaicAIがAPIキーを正しく管理できることを確認

### 4.3 設定ファイルとMosaicAIの統合
- 設定ファイルからMosaicAIインスタンスが正しく生成されることを確認

## 5. テストデータ
- サンプルのテキストプロンプト
- テスト用の画像ファイル
- サンプルのJSONスキーマ
- モックAPIレスポンス

## 6. CI/CD統合
- GitHubActionsを使用して自動テストを設定
- プルリクエスト時に全てのテストが実行されることを確認

## 7. テスト報告
- テスト結果のサマリーを自動生成
- 失敗したテストの詳細情報を提供

## 8. テストディレクトリ構造

```
tests/
├── unit/
│   ├── test_mosaic_ai.py
│   ├── test_api_key_manager.py
│   ├── test_chatgpt.py
│   ├── test_claude.py
│   ├── test_gemini.py
│   └── test_perplexity.py
└── integration/
    └── test_mosaic_ai_integration.py

```

この仕様書に基づいてテストを実装することで、MosaicAIの信頼性と品質を確保できます。